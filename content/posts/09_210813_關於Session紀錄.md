---
title: "é—œæ–¼ Session èˆ‡ Cookie - [ Sessionç¯‡ ] ç´€éŒ„"
subtitle: "é—œæ–¼ Session èˆ‡ Cookie - Sessionç¯‡ç´€éŒ„"
date: 2021-08-13T18:36:14+08:00
draft: false
url: "posts/09/210813/sessionç´€éŒ„"
summary: <p align="center">Session èˆ‡ Cookie - [ Session ] ç¯‡ç´€éŒ„</p><img src="/blog/images/09_210813/09_210813_session.png" width="50%"/>
author: "linooohon"
email: "linooohon@gmail.com"
toc: true
tags: ["Session", "Web", "Cookie", "Http"]
categories: ["2021", "http"]
---

<h1 style="text-align:center">
é—œæ–¼ Session èˆ‡ Cookie - < Sessionç¯‡ > ç´€éŒ„
</h1>

> å‰é™£å­åœ¨å¹«å¿™é–‹ç™¼å…¬å¸çš„ Nodejs å°ˆæ¡ˆï¼Œåœ¨è™•ç†ä¸Šï¼Œç™¼ç¾è‡ªå·±å° Cookie å’Œ Session çš„æ¦‚å¿µé‚„æ²’æœ‰å¾ˆæ¸…æ™°ï¼Œæ‰€ä»¥ç ”ç©¶äº†ä¸€ä¸‹ï¼Œåœ¨æ­¤ç´€éŒ„ï¼Œä¹Ÿé †ä¾¿åˆ†äº«å‡ºä¾†ã€‚

![é—œæ–¼ Session èˆ‡ Cookie - < Sessionç¯‡ > ç´€éŒ„](/blog/images/09_210813/09_210813_session.png)


é›–ç„¶æˆ‘çš„ Blog æ‡‰è©²æ˜¯ SEO å·®åˆ°çˆ†çš„é‚Šç·£ Blog, ä¸éè‡ªå·±ä¹Ÿæ»¿å–œæ­¡ç´€éŒ„çš„ï¼Œå°±é‚Šå­¸é‚Šæ•´ç†ä¸‹ä¾†ï¼Œæœ‰ç·£äººè‹¥çœ‹åˆ°æ­¤ç¯‡ï¼Œæ­¡è¿èˆ‡æˆ‘è¨è«–ï¼Œå¦‚æœæœ‰éŒ¯ç…©è«‹æŒ‡æ•™ã€‚

> åº•ä¸‹çš„ç´€éŒ„ä¹Ÿåƒè€ƒäº†è«¸å¤šç¯‡æ–‡ç« èˆ‡å¤§å¤§çš„ Blog, å¦‚æœ‰ä¸€äº›é›·åŒçš„æ•˜è¿°ï¼Œè«‹è¦‹è«’ ğŸ™


```
è¦ææ‡‚ä¸€å€‹æ±è¥¿ï¼Œå°±è¦ä¸æ–·å• "ç‚ºä»€éº¼" å’Œ "å¦‚ä½•" ã€‚
```

## **< æ­¤æ¬¡ç´€éŒ„é‡é» >**

`é›–ç„¶å¾ˆå¤šäººåœ¨è§£é‡‹ Session æ™‚æœƒèˆ‡ Cookie ä¸€èµ·è§£é‡‹ï¼Œä½†æ­¤ç¯‡æˆ‘æƒ³å…ˆç›¡é‡å°ˆæ³¨åœ¨ Session ï¼Œå…ˆä¸èˆ‡ Cookie æ··è‘—è«‡ã€‚`

## **< ä»€éº¼æ˜¯ Session çµ±æ•´ >**

### å„æ–¹è§£é‡‹: 

- å¾å­—æœ¬èº«èªç¾©åˆ‡å…¥

  1. å…·æœ‰ç‹€æ…‹çš„ä¸€æ®µæ™‚é–“
  2. ä¸Šä¸‹æ–‡
  3. ä¸­æ–‡ç¿»è­¯: "æœƒè©±"

- ç”Ÿæ´»ä¾‹å­: æœ‰å§‹æœ‰çµ‚çš„ä¸€ç³»åˆ—å‹•ä½œ/æ¶ˆæ¯

  - ex: æ‰“é›»è©±æ˜¯å¾æ‹¿èµ·é›»è©±æ’¥è™Ÿåˆ°æ›æ–·é›»è©±ï¼Œé€™ä¸­é–“çš„ä¸€ç³»åˆ—éç¨‹ç¨±ä¹‹ç‚ºä¸€å€‹ session

- ç•¶ Session èˆ‡ç¶²è·¯å”è­°ç›¸é—œæ™‚:

  - æœ‰é€£æ¥æˆ–ä¿æŒç‹€æ…‹çš„æ„æ€

- ç•¶ Session åœ¨ Web é–‹ç™¼é ˜åŸŸæ™‚æœ‰ä¸€äº›è©®é‡‹:

  1. æ¦‚å¿µ:
     - å°‡ Clientç«¯ èˆ‡ Serverç«¯ä¹‹é–“äº¤äº’çš„éç¨‹ï¼ŒæŠ½è±¡ç‚º"æœƒè©±"ï¼Œé€²è€Œè¡ç”Ÿå‡º "æœƒè©±çš„ç‹€æ…‹"(åµæ¸¬/è§€æ¸¬äº¤äº’éç¨‹çš„ç‹€æ…‹)ï¼Œä¹Ÿå°±æ˜¯èªªé€™æ™‚çš„ Session æ˜¯ä¸€ç¨®æ¦‚å¿µ

  2. ç‹€æ…‹ç®¡ç†çš„è§£æ±ºæ–¹æ¡ˆ/æ©Ÿåˆ¶/å¯¦ç¾:

     - i. Clientç«¯ èˆ‡ Serverç«¯ä¹‹é–“ä¿æŒç‹€æ…‹çš„ "è§£æ±ºæ–¹æ¡ˆ(æ©Ÿåˆ¶)"ï¼Œä¹Ÿå°±æ˜¯èªªé€™æ™‚å¾Œï¼ŒSession æŒ‡çš„æ˜¯ä¸€ç¨®ç‹€æ…‹ç®¡ç†çš„è§£æ±ºæ–¹å¼(æ©Ÿåˆ¶)

     - ii. Session æ˜¯ä¸€ç¨® Serverç«¯çš„æ©Ÿåˆ¶ï¼ŒServer ä½¿ç”¨ä¸€ç¨®é¡ä¼¼æ–¼ Hash Table(é›œæ¹Šè¡¨/æ•£åˆ—è¡¨/å“ˆå¸Œè¡¨) (ä¹Ÿå¯èƒ½å°±æ˜¯ Hash Table)çš„çµæ§‹ä¾†ä¿å­˜è¨Šæ¯ï¼Œåœ¨é€™ Session æŒ‡çš„ä¹Ÿæ˜¯ä¸€ç¨®ç‹€æ…‹ç®¡ç†çš„è§£æ±ºæ–¹å¼(æ©Ÿåˆ¶)

  3. å„²å­˜çµæ§‹:
     - Clientç«¯ èˆ‡ Serverç«¯ä¹‹é–“ä¿æŒç‹€æ…‹çš„ "è§£æ±ºæ–¹æ¡ˆ(æ©Ÿåˆ¶)çš„å­˜å„²çµæ§‹"ï¼Œä¹Ÿå°±æ˜¯èªªé€™æ™‚å€™ï¼ŒSession æŒ‡çš„æ˜¯ä¸€ç¨®ç‹€æ…‹ç®¡ç†çš„è§£æ±ºæ–¹å¼(æ©Ÿåˆ¶)çš„ "å„²å­˜çµæ§‹"

  4. è³‡æ–™(ç‹€æ…‹/è³‡è¨Š)æœ¬èº«:
     - å› ç‚º 1. çš„æ¦‚å¿µè€Œè¡ä¼¸å‡ºï¼Œåœ¨å»ºç«‹ 2. çš„ç‹€æ…‹ç®¡ç†çš„è§£æ±ºæ©Ÿåˆ¶å¾Œæˆ‘å€‘é€é 3. çš„å„²å­˜çµæ§‹å»æŠŠæ‰€è¦å„²å­˜çš„ç‹€æ…‹å„²å­˜èµ·ä¾†ï¼Œé€™äº›ç‹€æ…‹æœ‰æ™‚æœƒçœ‹åˆ°æœ‰äººå¯«ç›´æ¥å°±èªªæ˜¯ Session Information(Session è³‡è¨Š)ã€‚æ‰€ä»¥æœ‰æ™‚å€™äººå®¶èªª Session ä¹Ÿæœ‰å¯èƒ½æŒ‡çš„æ˜¯ Session è³‡è¨Šæœ¬èº«ï¼Œ`Session == Session è³‡è¨Š ?` æ‰€ä»¥æˆ‘è¦ºå¾—æ¦‚å¿µé‚„æ˜¯è¦æ‡‚ï¼Œæ¯”æ¬¡æºé€šæ‰æœƒæ¯”è¼ƒé †ï¼Œé»˜å¥‘ä¹Ÿæ¯”è¼ƒå¥½ï¼Œå› ç‚ºæŠ€è¡“åè©æœ‰æ™‚å€™å°±æ˜¯æœ‰é»æ›–æ˜§ï¼Œèªªåˆ°é€™è‡ªå·±çš„å¯¦åŠ›é‚„æ˜¯ä¸è¡Œå•Š....åŠ æ²¹ï¼

## **< ä»€éº¼æ˜¯ Session è‡ªæˆ‘çµ±æ•´ >**

### æ‰€ä»¥æœƒç™¼ç¾ç•¶æˆ‘å€‘å–®ç´”èªª Session æ™‚ï¼Œå…¶å¯¦æœ‰å¤ªå¤šå®šç¾©æ¨¡ç³Šçš„ç©ºé–“ã€‚
è‡ªå·±çµ±æ•´å¾Œï¼Œ
#### Session çš„å«ç¾©å¯ä»¥æœ‰ä»¥ä¸‹æ•¸ç¨®:

##### 1. å«ç¾©1:
åœ¨å¹³å¸¸ç”Ÿæ´»ä¸Šå–®å–®å°±å–®å­—ç”¨æ³•å°±æ˜¯æŒ‡å…·æœ‰ç‹€æ…‹çš„ä¸€æ®µæ™‚é–“ã€æœƒè­°ã€é–‹æœƒã€ä¸€æ¬¡äº¤æµã€‚
å¦‚æœæœ‰åœ¨è·³èˆçš„äººå¯èƒ½å¸¸è½åˆ° Session é€™å€‹å­—çœ¼ï¼Œæ¯ç•¶è½åˆ°é€™å€‹è©æ™‚ï¼Œå¯èƒ½æœƒæ˜¯æŒ‡ä¸€æ¬¡æ¯”è³½çš„å‡ºå ´ï¼Œä¸€æ¬¡æ´»å‹•ï¼Œä¸€å€‹round, ä¸€æ®µæ™‚é–“å…§å½¼æ­¤çš„è·³èˆäº¤æµæ™‚é–“ã€‚

##### 2. å«ç¾©2:
æ¥ä¸‹ä¾†é–‹å§‹è©¦è‘—æ…¢æ…¢å¼•å°åˆ° Web ç›¸é—œçš„å«ç¾©ã€‚
Session èˆ‡ç¶²è·¯å”è­°ç›¸é—œæ™‚ï¼Œæœ‰æ™‚æ˜¯ã€Œé€£æ¥ã€çš„æ„æ€:
èˆ‰ä¾‹1. æ¯”å¦‚ç•¶ä½ è¦å»ºç«‹é€šä¿¡çš„æ¸ é“ï¼Œåƒæ˜¯æ‰“é›»è©±ï¼Œä½ è¦ç¢ºå®šå°æ–¹æ¥äº†é›»è©±é€šä¿¡æ‰é–‹å§‹ï¼Œé€™ä¹Ÿæ˜¯ Session çš„å«ç¾©ä¹‹ä¸€ã€‚
èˆ‰ä¾‹2. ä¸€æ¨£æ˜¯å»ºç«‹é€šä¿¡çš„æ¸ é“, åƒæ˜¯å¯«ä¿¡ï¼Œä½ å¯«å‡ºå»æ™‚ä¸ç¢ºå®šåœ°å€å°ä¸å°ï¼Œé›–ç„¶æ”¶ä¿¡äººä¸ä¸€å®šèƒ½æ”¶åˆ°ï¼Œä½†åƒ…åƒ…å°æ–¼ç™¼ä¿¡äººä¾†èªªï¼Œä»–ä¹Ÿæœƒèªç‚ºé€™å€‹ Session å·²ç¶“é–‹å§‹äº†ï¼Œé€™ä¹Ÿæ˜¯ä¸€ç¨® Session çš„è¡¨ç¾ã€‚

##### 3. å«ç¾©3:
Session èˆ‡ç¶²è·¯å”è­°ç›¸é—œæ™‚ï¼Œå¦ä¸€å€‹æ„æ€æ˜¯ã€Œä¿æŒç‹€æ…‹ã€çš„æ„æ€:
é€™å€‹ä¿æŒç‹€æ…‹æŒ‡çš„æ˜¯ï¼Œåœ¨é€£æ¥ä¹‹é¤˜ï¼Œé€£æ¥çš„ä¸€æ–¹èƒ½å¤ æŠŠä¸€ç³»åˆ—ç›¸é—œçš„è¨Šæ¯(ç‹€æ…‹/è³‡è¨Š)é—œè¯èµ·ä¾†ï¼Œæ¯”å¦‚èªªå¸¸å»åƒçš„éºµæ”¤è€é—†å¨˜å¥¹ä¸€çœ¼å°±èƒ½è¨˜å¾—ä¸Šæ¬¡ä½ å¿˜è¨˜å¸¶éŒ¢èªªè¦é€™æ¬¡ä¾†å†ä»˜ï¼Œä¹Ÿè¨˜å¾—ä½ æœ€æ„›é»çš„æµ·é®®éºµï¼Œç›´æ¥å°±å¹«ä½ åšäº†ï¼Œé€™é¡ã€Œä¿æŒç‹€æ…‹ã€çš„ä¾‹å­æœ‰ã€Œä¸€å€‹ TCP sessionã€, ã€Œä¸€å€‹ POP3 sessionã€

##### 4. å«ç¾©4:
Session é€²åˆ° Web Appçš„é ˜åŸŸæ™‚:
Session åœ¨ç¾ä»Š Webé–‹ç™¼é ˜åŸŸä¸‹ï¼Œå¯ä»¥æŒ‡ Client ç«¯èˆ‡ Server ç«¯ä¹‹é–“äº¤äº’çš„éç¨‹ï¼Œæœ‰æ™‚æœƒæŠŠé€™å€‹éç¨‹çµ±æ•´æˆã€Œæœƒè©±ã€é€™å€‹è©ï¼Œæ­¤æ™‚çš„ Session æ˜¯ä¸€ç¨®æ•´é«”çš„æ¦‚å¿µã€‚

##### 5. å«ç¾©5:
ç•¶æˆ‘å€‘çŸ¥é“ Session å¯ä»¥æŒ‡æœ‰å§‹æœ‰çµ‚çš„ä¸€ç³»åˆ—å‹•ä½œ(ç‹€æ…‹/æ¶ˆæ¯)æ™‚ï¼Œex: åƒæ˜¯æ‰“é›»è©±å¾æ’¥è™Ÿåˆ°æ›æ–·çš„ä¸€ç³»åˆ—éç¨‹ã€‚
æ‰€ä»¥æœ‰æ™‚çœ‹åˆ°ã€Œåœ¨ä¸€å€‹ Browser çš„æœƒè©±æœŸé–“..ã€æ˜¯æŒ‡å¾ç€è¦½å™¨è¦–çª—æ‰“é–‹åˆ°é—œé–‰çš„é€™å€‹æœŸé–“å°±å«åšä¸€å€‹ Sessionã€‚

##### 6. å«ç¾©6:
æœ‰æ™‚çœ‹åˆ°ã€Œ Client çš„ä¸€æ¬¡æœƒè©±æœŸé–“..ã€å¯ä»¥æŒ‡åŒå€‹ç›®çš„çš„ä¸€ç³»åˆ—å‹•ä½œï¼Œåƒæ˜¯å¾ç™»éŒ„åˆ°é¸è³¼å•†å“åˆ°çµå¸³ç™»å‡ºï¼Œé€™æ¨£çš„ä¸€å€‹éç¨‹å¯ä»¥ç¨±ä½œä¸€å€‹ Session, åŒæ™‚ä¹Ÿå¯è¢«ç¨±ç‚ºæ˜¯åœ¨è³‡æ–™è™•ç†ä¸Šçš„ä¸€æ¬¡ transactionï¼Œæ‰€ä»¥åœ¨ã€Œ Client çš„ä¸€æ¬¡æœƒè©±æœŸé–“..ã€çš„è§£é‡‹ä¸‹ï¼Œé–‹ç™¼è€…åœ¨å½¼æ­¤æºé€šæ™‚è¦ç†è§£é€™å€‹éç¨‹çš„é ­è·Ÿå°¾åˆ°åº•å½¼æ­¤æŒ‡çš„ä¸€ä¸ä¸€æ¨£ã€‚å› ç‚ºæœ‰æ™‚å€™å¯èƒ½ A æƒ³çš„åªæ˜¯ä¸€æ¬¡æ€§çš„æŸå€‹å‹•ä½œæœŸé–“ï¼Œä½† B æ‰€æƒ³çš„æ˜¯å¥½å¹¾å€‹å‹•ä½œåˆèµ·ä¾†çš„æœŸé–“ã€‚

##### 7. å«ç¾©7:
æ‰€ä»¥ç•¶æˆ‘å€‘å¾å«ç¾©4, 5, 6 è§£é‡‹éä¾†æœƒç™¼ç¾ï¼Œé€™å€‹äº¤äº’çš„éç¨‹å…¶å¯¦ä¹Ÿå¾ä¸€ç¨®æ¦‚å¿µæ¼”è®Šæˆå¯¦éš›é‹è¡Œçš„æ©Ÿåˆ¶ï¼Œä¹Ÿå°±è®Šæˆè¼ƒåå‘å¤§å®¶æ‰€èªçŸ¥çš„ Session å®šç¾©çš„å…¶ä¸­ä¸€ç¨®ï¼Œå°±æ˜¯ Clientç«¯èˆ‡ Serverç«¯ä¹‹é–“ä¿æŒç‹€æ…‹çš„ã€Œæ©Ÿåˆ¶(è§£æ±ºæ–¹æ¡ˆ)ã€ã€‚

##### 8. å«ç¾©8:
é‚£ç•¶æœ‰äººå•èªªä½ æ˜¯ã€Œå­˜åœ¨ Cookie é‚„æ˜¯ Sessionæ™‚?ã€é€™å¥è©±åœ¨æˆ‘ä»¥å‰å‰›å­¸ç¨‹å¼æ™‚ï¼Œè¦ºå¾—å•é€™æ¨£çš„ä¸€å€‹å•é¡Œæ²’ä»€éº¼ï¼Œä¹ŸæŒºå°ˆæ¥­çš„(å¤ªç„¡çŸ¥äº†..)ï¼Œä½†ç¶“éæˆ‘çš„ç ”è®€å’ŒæŸ¥é–±ï¼Œæˆ‘èªç‚ºäº‹å¯¦æ˜¯å•å•é¡Œé‚„æ˜¯å¿…é ˆå•çš„ç²¾ç¢ºä¸€é»æ¯”è¼ƒå¥½ï¼Œæ­¤ç¯‡ä¸è¨è«– Cookieï¼ŒCookie ç¢ºå¯¦æ˜¯ä¸€å€‹å„²å­˜çš„ç©ºé–“ï¼Œä½†å­˜åœ¨ Session å°±æœ‰é»ä¸å¤ªç²¾ç¢ºï¼Œç¡¬è¦è§£é‡‹ï¼Œå¤§éƒ¨åˆ†éƒ½æ˜¯è§£é‡‹æˆå¯¦ä½œ Session é€™ç¨®æ©Ÿåˆ¶çš„ä½œæ³•ï¼ŒæŠŠè³‡æ–™å­˜åœ¨ä¸€äº›å¯ä»¥å­˜è³‡æ–™çš„åœ°æ–¹ï¼Œåƒæ˜¯è¨˜æ†¶é«”(Memory)ã€å¿«å–(Cache)ã€Cookieã€è³‡æ–™åº«(Database)ï¼Œæ‰€ä»¥ç•¶é€™æ¨£çš„ä¸€å€‹å•é¡Œå‡ºç¾æ™‚ï¼Œç„¡æ³•å»å®šç¾©æ­¤æ™‚çš„ Session æ˜¯ä»€éº¼ï¼Œæˆ‘å€‘å¯ä»¥çŒœæ¸¬çš„æ˜¯ä¹Ÿè¨±æ­¤åˆ»çš„ Session æŒ‡çš„æ˜¯è³‡æ–™æ”¾çš„åœ°æ–¹ã€‚æˆ–æ˜¯å¦ä¸€å€‹å«ç¾©åƒæ˜¯å«ç¾© 9ã€‚

##### 9. å«ç¾©9:
æ ¹æ“šå«ç¾©8ï¼Œæœ‰æ™‚ Session ä¹ŸæœƒæŒ‡å¯¦è¸ Session æ©Ÿåˆ¶æ™‚ï¼Œè³‡æ–™è¢«å„²å­˜æ™‚æœ¬èº«çš„è³‡æ–™çµæ§‹ã€‚

##### 10. å«ç¾©10:
æ ¹æ“šå«ç¾©7, 8, 9ï¼Œæˆ‘å€‘å¯ä»¥çŸ¥é“è³‡æ–™(ç‹€æ…‹/è³‡è¨Š)æœ¬èº«ï¼Œä¹Ÿæœ‰æ©Ÿæœƒè¢«ç¨±ç‚º Sessionï¼Œç•¶æˆ‘å€‘èªªã€Œæ‹¿ Session è³‡æ–™ã€ï¼Œé›–ç„¶æ¯”è¼ƒä¸æœƒè¢«èªç‚º Session æœ¬èº«å°±æ˜¯è³‡æ–™ï¼Œä½†é‚„æ˜¯è¦è¨˜å¾—æœ‰é€™éº¼ä¸€å€‹å¯èƒ½æ€§ã€‚

##### 11. å«ç¾©11:
ä¸åŒçš„èªè¨€åŠæ¡†æ¶åœ¨å¯¦è¸ Session æ¦‚å¿µæ™‚ï¼Œä¹Ÿæœƒæœ‰ä¸åŒä½œæ³•ï¼Œæ­¤æ™‚çš„ Session å°±æœƒå› æ­¤è€Œæœ‰äº›å„æ–¹å¯¦ä½œåŠå®šç¾©ä¸Šçš„å·®ç•°ã€‚

## **< ç‚ºä»€éº¼å‡ºç¾ Session >**

### å„æ–¹è§£é‡‹:

- HTTP Stateless:ä»¥ç„¡ç‹€æ…‹è§’åº¦åˆ‡å…¥
  1. ç”±æ–¼ Http ç‚º Stateless protocol(ç„¡ç‹€æ…‹å”è­°)ï¼Œä½†åœ¨ Web é ˜åŸŸä¸­ï¼Œserver æ™‚å¸¸éœ€è¦ç´€éŒ„ User çš„ç‹€æ…‹ï¼Œä½† Http æ˜¯ç„¡ç‹€æ…‹çš„ï¼Œæ‰€ä»¥å°±éœ€è¦æŸç¨®æ©Ÿåˆ¶ä¾†ç´€éŒ„è­˜åˆ¥ç”¨æˆ¶çš„ç‹€æ…‹ï¼Œè€Œ Session å°±å‡ºå ´äº†ã€‚

- æˆ‘èªç‚ºåˆç†çš„ç°¡å–®è§£é‡‹:
  1. è§£æ±ºç„¡ç‹€æ…‹ï¼ŒSession å‡ºç¾å¹«å¿™
  2. æ ¹æ“š [RFC 2109](https://datatracker.ietf.org/doc/html/rfc2109) session å¯ä»¥æŒ‡ä¸€ç¨®äº¤äº’ç‹€æ…‹(é—œä¿‚)ï¼Œé€™è£¡é¢åŒ…æ‹¬ Client çš„ Request å’Œ Server çš„ Response ä¹‹é–“çš„äº¤äº’å…§å®¹ï¼Œæœ€æ—©æœƒå‡ºç¾ï¼Œè£¡é¢ä¹ŸæåŠæ˜¯å› ç‚ºè¦å»ºç«‹ Statefulï¼Œè£¡é¢èªªé“:

```
3.  STATE AND SESSIONS

   This document describes a way to create stateful sessions with HTTP
   requests and responses.  Currently, HTTP servers respond to each
   client request without relating that request to previous or
   subsequent requests; the technique allows clients and servers that
   wish to exchange state information to place HTTP requests and
   responses within a larger context, which we term a "session".  This
   context might be used to create, for example, a "shopping cart", in
   which user selections can be aggregated before purchase, or a
   magazine browsing system, in which a user's previous reading affects
   which offerings are presented.

   There are, of course, many different potential contexts and thus many
   different potential types of session.  The designers' paradigm for
   sessions created by the exchange of cookies has these key attributes:

      1.  Each session has a beginning and an end.

      2.  Each session is relatively short-lived.

      3.  Either the user agent or the origin server may terminate a
          session.

      4.  The session is implicit in the exchange of state information.
```


<p style="color: #549e76">
This document describes <span style="color: #ed61cb">a way to create stateful sessions with HTTP
   requests and responses.</span> Currently, HTTP servers respond to each
   client request without relating that request to previous or
   subsequent requests;
</p>


<p style="color: #549e76">
the technique <span style="color: #ed61cb">allows clients and servers that
   wish to exchange state information to place HTTP requests and
   responses within a larger context</span>, which we term a <span style="color: #e35040">"session"</span>.
</p>



> æ›´è©³ç´°å¯ä»¥åƒè€ƒ: [Huliå¤§å¤§é€™ç¯‡](https://blog.techbridge.cc/2019/08/10/session-and-cookie-rfc/)


## **< Session è³‡è¨Š å„²å­˜ä½ç½® >**

### 1. è¨˜æ†¶é«”
- å°æ‡‰ç”¨åœ¨é–‹ç™¼ç’°å¢ƒæ™‚ï¼Œå¦‚æœä¸éœ€è¦å…±äº«ç‹€æ…‹çš„æƒ…æ³ä¸‹ï¼Œå­˜è¨˜æ†¶é«”æ˜¯å€‹æ–¹ä¾¿çš„æ–¹å¼ï¼Œä½†é™¤æ­¤ä¹‹å¤–ä¹Ÿæ²’æœ‰ä»€éº¼å¥½è™•ã€‚
### 2. Cookie
- æŠŠ Session è³‡è¨Šå­˜åœ¨ Cookieï¼Œä¹Ÿå°±æ˜¯ä¸æ˜¯ Server å­˜ç‹€æ…‹äº†ï¼Œæ˜¯ Client å­˜ï¼Œæ‰€ä»¥æ¯æ¬¡ request éƒ½æœƒç›´æ¥å¸¶ä¸Š Session è³‡è¨Šï¼Œæ‰€ä»¥ä¸ç”¨æ“”å¿ƒéœ€è¦å…±äº«ç‹€æ…‹çš„å•é¡Œï¼Œå®‰å…¨æ€§å•é¡Œçš„è©±ï¼ŒæŒ‰ç…§ä¸€èˆ¬åšæ³•ä¸€å®šæœƒåšè™•ç†(æ¯”å¦‚èªª SignedCookieçš„ä½œæ³•)ç­‰ç­‰ï¼ŒçœŸæ­£æ¯”è¼ƒå¤§çš„å•é¡Œæ˜¯è³‡æ–™å‚³è¼¸çš„é‡è®Šå¤§ã€‚
### 3. å¿«å– (ex: Redis)
- é€™æ˜¯å¤§éƒ¨ä»½æœ€å¸¸ç”¨çš„æ–¹å¼ï¼Œç‰¹é»å¿«ï¼Œä¹Ÿå¯ä»¥å…±äº«ç‹€æ…‹ï¼Œç›¸æ¯”å­˜åœ¨ Cookie ï¼Œç•¶ Session è³‡è¨Šé‡å¤§çš„æ™‚å€™ï¼Œå¯ä»¥ç¯€çœç¶²è·¯çš„å‚³è¼¸ã€‚
### 4. è³‡æ–™åº«
- ä¾éœ€æ±‚ä½¿ç”¨ï¼Œä¸€èˆ¬ä¸å¸¸å‡ºç¾ã€‚

## **< å¯¦è¸ Session æ¦‚å¿µ(æ©Ÿåˆ¶)çš„å…©ç¨®æ–¹å¼ >**

1. Cookie-Based Session (ä¹Ÿå°±æ˜¯ Client Side Session)
2. ä½¿ç”¨ SessionID (ä¹Ÿå°±æ˜¯ Server Side Session ) 


- 1. æ‰€è¬‚ Cookie-based session æŒ‡çš„æ˜¯ï¼Œä»Šå¤©è¦å­˜çš„è³‡æ–™(ç‹€æ…‹)éƒ½æ”¾åœ¨ cookie ï¼Œæœ‰å¯èƒ½æ˜¯æ˜æ–‡å­˜ï¼Œä¹Ÿæœ‰å¯èƒ½æ˜¯è™•ç†é(ç·¨ç¢¼ã€åŠ å¯†)å­˜ï¼Œä½†åŸºæœ¬ä¸Šå®‰å…¨æ€§å•é¡Œï¼Œå°±ç®—æ”¾åŸºæœ¬ä¸Šéƒ½æœƒåŠ å¯†ï¼Œç¼ºé»æ˜¯ï¼šå­˜å¤ªå¤šæ±è¥¿åœ¨ Cookie ï¼Œæœƒè®Šå¾—å¤ªç¬¨é‡ã€‚


- 2. SessionID çš„ä½¿ç”¨æ–¹å¼æ˜¯ï¼ŒæŠŠè³‡æ–™ã€ç‹€æ…‹å­˜åœ¨ Serverï¼Œç„¶å¾Œ Server å‚³çš„ Set-cookie æ˜¯å‚³ä¸€å€‹ SessionIDï¼Œé€™å€‹ SessionID çš„åšç”¨å°±æ˜¯ç•¶ Browser å‚³éä¾† Server æ™‚ï¼ŒServer æœƒå»æ¯”å°é€™å€‹ SessionID æ˜¯ä¸æ˜¯è·Ÿç•¶åˆä¸€é–‹å§‹ç™¼çµ¦ Browser æ™‚çš„ç´€éŒ„æ˜¯ä¸€æ¨£çš„ï¼Œç›¸ç•¶æ–¼ä¸€å€‹ Keyï¼Œåˆ©ç”¨é€™å€‹ SessionID å»æ›å­˜åœ¨ Server çš„è³‡æ–™ã€ç‹€æ…‹ï¼Œå¦‚æ­¤åœ¨ Server å’Œ Browser å°±å¯ä»¥ç¶­æŒç‹€æ…‹ç´€éŒ„ï¼Œè§£æ±º HTTP Stateless

RFC 6265 æåˆ°é—œæ–¼ SessionID çš„ä¾‹å­

> < RFC 6265 >
>
> [rfc6265 (ietf.org)](https://datatracker.ietf.org/doc/html/rfc6265)
>
> Using the Set-Cookie header, a server can send the user agent a short string in an HTTP response that the user agent will return in future HTTP requests that are within the scope of the cookie. For example, the server can send the user agent a "session identifier" named SID with the value 31d4d96e407aad42. The user agent then returns the session identifier in subsequent requests.


## **< å¯¦è¸ Session æ¦‚å¿µ(æ©Ÿåˆ¶)çš„å…¶ä»–ç¨®æ–¹å¼ >**

1. form è£¡é¢æ”¾ä¸€å€‹ hidden çš„æ¬„ä½

```
<form name="testform" action="/xxx">
<input type="hidden" name="jsessionid" value="ByOK3vjFD75aPnrF7C2HmdnV6QZcEbzWoWiBYEnLerjQ99zWpBng!-145788764">
<input type="text">
</form>
```

2. ç¶²å€åˆ—å¸¶è³‡è¨Š(URLé‡å¯«)
```
http://...../xxx;jsessionid= ByOK3vjFD75aPnrF7C2HmdnV6QZcEbzWoWiBYEnLerjQ99zWpBng!-145788764
```
```
http://...../xxx?jsessionid=ByOK3vjFD75aPnrF7C2HmdnV6QZcEbzWoWiBYEnLerjQ99zWpBng!-145788764
```


## **< å¯¦è¸ Session æ¦‚å¿µ(æ©Ÿåˆ¶)æœ€å¸¸è¦‹åšæ³• >**

- Server å¦‚æœéœ€è¦ session (æ¦‚å¿µoræ©Ÿåˆ¶orçµæ§‹)ã€‚çœ‹æ€éº¼è§£é‡‹ï¼Œä½†é€šå¸¸å¤§å®¶åœ¨èªªçš„å°±æ˜¯ï¼Œå­˜æŸäº›ç‹€æ…‹åœ¨ Serverã€‚é‚£æœ€å¸¸è¦‹çš„å°±æ˜¯ï¼ŒServer å®ƒæƒ³åˆå§‹åŒ–ä¸€å€‹ sessionï¼Œæ–¼æ˜¯å®ƒå°±å›å‚³ä¸€å€‹ Set-Cookie çš„ Header åˆ° User Agent, å¦‚æœé€™æ™‚å€™ Browser æ±ºå®šç¹¼çºŒé€™å€‹ session çš„è©±ï¼Œå¯ä»¥å›å‚³ Cookie é€™å€‹ Headerã€‚

> é€™ä¹Ÿæ˜¯ç•¶åˆ RFC2109 [rfc2109 (ietf.org)](https://datatracker.ietf.org/doc/html/rfc2109)çš„ç‰‡æ®µæ‰€æè¿°çš„ï¼Œä¹Ÿæ˜¯æˆ‘å€‘ç¾åœ¨å¸¸å¸¸åœ¨åšçš„äº‹ï¼Œåˆ©ç”¨ Cookie å»å¯¦ç¾ session é€™å€‹åŠŸèƒ½ã€‚


## **< The End >**

> æ¥ä¸‹ä¾†å†æ‰¾æ™‚é–“å¯« Cookie åŠå…¶ä»–ç›¸é—œç´€éŒ„
### Self Checklist:
- [x]Explain what is `Session`.
- [x]Understand `Session` can means lots of things.
- [x]Know how to resolve problem with `Session`.


### Reference:
- https://www.zhihu.com/question/19786827
- https://blog.techbridge.cc/2019/08/10/session-and-cookie-rfc/
- https://datatracker.ietf.org/doc/html/rfc2109
- https://fred-zone.blogspot.com/2014/01/web-session.html
- https://iter01.com/194145.html
- https://blog.hellojcc.tw/introduce-session-and-cookie/
- https://wiki.jikexueyuan.com/project/node-lessons/cookie-session.html
- https://juejin.cn/post/6844904073934667790
- https://yken919.pixnet.net/blog/post/45702341

## **< Next ä¸‹ä¸€ç¯‡ >**
